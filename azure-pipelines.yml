trigger:
  batch: true
  branches:
    include:
      - "*"

pr: none

pool:
  name: Hosted VS2017
  demands:
    - DotNetFramework
    - npm
    - node.js

steps:
- task: gittools.gitversion-preview.gitversion-task.GitVersion@5
  displayName: GitVersion
  inputs:
    configFilePath: GitVersion.yml

- script: |
    npm install eclint
    node ./node_modules/eclint/bin/eclint.js check
  displayName: "Validate editorconfig against src"
  workingDirectory: $(System.DefaultWorkingDirectory)/src

- task: PowerShell@1
  displayName: 'Execute Build'
  inputs:
    scriptName: tools/build.ps1

- script: |
    npm install eclint
    node ./node_modules/eclint/bin/eclint.js check
  displayName: "Validate editorconfig against release"
  workingDirectory: $(System.DefaultWorkingDirectory)/Release

- task: PublishTestResults@2
  displayName: 'Publish Test Results **\TEST_*.xml'
  inputs:
    testResultsFormat: NUnit
    testResultsFiles: '**\TEST_*.xml'
  continueOnError: true

- task: CopyFiles@2
  displayName: 'Copy Files to: Release'
  inputs:
    SourceFolder: tools
    Contents: |
      Publish-PSModule.ps1
    TargetFolder: Release

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: Release'
  inputs:
    PathtoPublish: Release
    ArtifactName: Release

